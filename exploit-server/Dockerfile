FROM ubuntu:18.04

# Add all required files
ADD marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec-0.0.3-SNAPSHOT-all.jar
ADD requirements.txt requirements.txt

# Listen on this port
EXPOSE 9001

# Install jdk 8
RUN apt-get update && \
    apt-get install -y openjdk-8-jdk && \
    apt-get install -y ant && \
    apt-get clean;
    
# Fix certificate issues
RUN apt-get update && \
    apt-get install ca-certificates-java && \
    apt-get clean && \
    update-ca-certificates -f;

# Setup JAVA_HOME -- useful for docker commandline
ENV JAVA_HOME /usr/lib/jvm/java-8-openjdk-amd64/
RUN export JAVA_HOME

# Install python3, pip and dependencies
RUN apt-get install -y python3 && \
    apt-get install -y python3-pip && \
    pip3 install -r requirements.txt;

RUN apt-get install -y netcat

# start ldap server and netcat listener
CMD ["python3", "/exploit_dir/poc.py"]